YUI.add("hermes-template-curation-edit-view",(function(t,e){var n=t.Template.Handlebars.revive({1:function(t,e,n,l,a){return"has-collage"},3:function(t,e,n,l,a){return"\t\t\t\t<div></div>\n\t\t\t\t<div></div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,a){var i,o,c=null!=e?e:t.nullContext||{},s=t.hooks.helperMissing,r=t.escapeExpression,u="function",m=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return r((m(n,"outlet")||e&&m(e,"outlet")||s).call(c,null!=e?m(e,"basic-closeable-header-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:1,column:0},end:{line:1,column:38}}}))+'\n<div class="curation-edit-container main">\n\t<div class="curation-edit-item curation-edit-title-item">\n\t\t<label for="curation-title-input">'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.TITLE"},data:a,loc:{start:{line:4,column:36},end:{line:4,column:75}}}))+'</label>\n\t\t<input type="text" id="curation-title-input" class="input-field curation-title-input" placeholder="'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.ADD_A_TITLE"},data:a,loc:{start:{line:5,column:101},end:{line:5,column:146}}}))+'" value="'+r(typeof(o=null!=(o=m(n,"title")||(null!=e?m(e,"title"):e))?o:s)===u?o.call(c,{name:"title",hash:{},data:a,loc:{start:{line:5,column:155},end:{line:5,column:164}}}):o)+'"/>\n\t</div>\n\t<div class="curation-edit-item curation-edit-description-item">\n\t\t<label for="curation-description-input">'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.DESCRIPTION"},data:a,loc:{start:{line:8,column:42},end:{line:8,column:87}}}))+'</label>\n\t\t<textarea id="curation-description-input" class="input-field curation-description-input" placeholder="'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.ADD_A_DESCRIPTION"},data:a,loc:{start:{line:9,column:104},end:{line:9,column:155}}}))+'" >'+r(typeof(o=null!=(o=m(n,"description")||(null!=e?m(e,"description"):e))?o:s)===u?o.call(c,{name:"description",hash:{},data:a,loc:{start:{line:9,column:158},end:{line:9,column:173}}}):o)+'</textarea>\n\t</div>\n\t<div class="curation-edit-item curation-edit-coverphoto-item">\n\t\t<label>'+r((m(n,"intlMessage")||e&&m(e,"intlMessage")||s).call(c,{name:"intlMessage",hash:{intlName:"common.COVER_PHOTO"},data:a,loc:{start:{line:12,column:9},end:{line:12,column:54}}}))+'</label>\n\t\t<div class="icon '+(null!=(i=m(n,"if").call(c,null!=e?m(e,"hasCollage"):e,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:13,column:19},end:{line:13,column:55}}}))?i:"")+'">\n\t\t\t<div class="photo"></div>\n'+(null!=(i=m(n,"if").call(c,null!=e?m(e,"hasCollage"):e,{name:"if",hash:{},fn:t.program(3,a,0),inverse:t.noop,data:a,loc:{start:{line:15,column:3},end:{line:18,column:10}}}))?i:"")+'\t\t</div>\n\t\t<a role="button" class="cover-photo-button" tabindex="0">'+r(typeof(o=null!=(o=m(n,"coverPhotoText")||(null!=e?m(e,"coverPhotoText"):e))?o:s)===u?o.call(c,{name:"coverPhotoText",hash:{},data:a,loc:{start:{line:20,column:59},end:{line:20,column:77}}}):o)+"</a>\n\t</div>\n</div>\n"+r((m(n,"outlet")||e&&m(e,"outlet")||s).call(c,null!=e?m(e,"basic-confirm-actions-view"):e,{name:"outlet",hash:{},data:a,loc:{start:{line:23,column:0},end:{line:23,column:37}}}))+"\n"},useData:!0}),l={};t.Array.each([],(function(e){var n=t.Template.get("hermes/"+e);n&&(l[e]=n)})),t.Template.register("hermes/curation-edit-view",(function(e,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,n(e,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("curation-edit-view",(function(e,i){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.coverPhotoUrl="",this.subviewConfig["basic-closeable-header-view"]=Object.assign(this.subviewConfig["basic-closeable-header-view"],{title:e.title,showCloseXButton:!0,onClose:this.handleCloseClick.bind(this)}),this.subviewConfig["basic-confirm-actions-view"]=Object.assign(this.subviewConfig["basic-confirm-actions-view"],{showMessage:!0,message:e.deleteMessage,messageIsError:!1,messageIsClickable:!0,confirmButtonText:this.intlMessage({intlName:"common.SAVE"}),onCancel:this.handleCloseClick.bind(this),onConfirm:this.handleSaveClick.bind(this),onMessageClick:this.handleDeleteClick.bind(this)})},subviewConfig:{"basic-closeable-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1},"basic-confirm-actions-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},loadState:function(){return this.params.coverPhotoId?this.appContext.getModel("photo-models",this.params.coverPhotoId).then((e=>{this.primaryPhotoModel=e,this.coverPhotoUrl=this.primaryPhotoModel.getValue("sizes").sq.displayUrl})):e.Promise.resolve()},buildContainer:function(e){var i=this.intlMessage({intlName:"common.CHOOSE_A_COVER_PHOTO"});this.coverPhotoUrl&&(i=this.intlMessage({intlName:"common.CHANGE_COVER_PHOTO"})),e.coverPhotoText=i,this.setContainerWithTemplate("curation-edit-view",e)},activate:function(){var e=this.get("container");this.confirmView=this.subviews["basic-confirm-actions-view"],this.titleField=e.one(".curation-title-input"),this.descriptionField=e.one(".curation-description-input"),this.coverPhotoItem=e.one(".curation-edit-coverphoto-item"),this.coverPhotoNode=this.coverPhotoItem.one(".photo"),this.coverPhotoButton=e.one(".cover-photo-button"),this.coverPhotoButton&&this.registerEventHandler(this.coverPhotoButton.on(["click","key"],this.handleCoverPhotoClick.bind(this),"down:13")),this.titleField.focus(),this.showCoverPhoto(this.coverPhotoUrl)},showCoverPhoto:function(e){this.coverPhotoNode.setStyle("backgroundImage","url("+e+")")},handleCloseClick:function(){this.fire("readyToClose")},showConfirmDeleteModal:function(){new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.CONFIRMATION"}),htmlMessage:this.params.confirmDeleteMessage,confirmButtonIsDangerous:!0,onConfirm:()=>this.handleDeleteConfirmClick(),onCancel:()=>e.fire("curationEdit:deleteCanceled"),onClose:()=>e.fire("curationEdit:deleteCanceled")}),hasSubviewConfigRefactor:!0}).show()},handleCoverPhotoClick:function(){this.storeEditedMeta("curationEdit:coverPhotoClicked")},handleDeleteClick:function(){this.storeEditedMeta("curationEdit:deleteClicked"),this.showConfirmDeleteModal()},storeEditedMeta:function(i){e.fire(i,{storedEditMeta:{title:this.titleField.get("value"),description:this.descriptionField.get("value")}})}})}),"@VERSION@",{requires:["flickr-view","hermes-template-curation-edit-view"],optionalRequires:["hermes-core"],langBundles:["common"]});YUI.add("album-edit-view",(function(t,i){var e=require("hermes-core/flog")(i);t.FlickrView.create(this.name,t.namespace("Views")["curation-edit-view"],[],{langBundles:this.details.langBundles,initializer:function(t){this.params=t,this.albumModel=this.params.albumModel,this.nsidOrPathAlias=this.params.nsidOrPathAlias,this.coverPhotoUrl="",this.coverPhotoText=""},buildContainer:function(){var t={title:this.params.curationTitle,description:this.params.curationDescription};return this.constructor.superclass.buildContainer.call(this,t)},activate:function(){var t=this.get("container");this.titleField=t.one(".curation-title-input"),this.descriptionField=t.one(".curation-description-input"),this.constructor.superclass.activate.call(this)},handleSaveClick:function(i,r){r.setButtonState({confirm:"loading"});var a=this.albumModel.getValue("id"),o=[],l={title:this.titleField.get("value"),description:this.descriptionField.get("value")},s=!1;return this.albumModel&&this.albumModel.getValue("id")!==this.params.coverPhotoId&&(!1===this.albumModel.hasPhoto(this.primaryPhotoModel.id)?(s=!0,l.primary=this.primaryPhotoModel.id):l.primary=this.primaryPhotoModel.id),this.albumModel.setValues(l),o.push(this.albumModel.remoteUpdate(a)),t.Promise.all(o).then((i=>{s&&t.fire("albumEdit:primaryPhotoIsNewToAlbum"),r.setButtonState({confirm:""}),this.fire("readyToClose")})).catch((function(t){throw e.error("Error updating album info",{err:t}),r.setButtonState({confirm:""}),t}))},handleDeleteConfirmClick:function(){return this.albumModel.remoteDelete(this.albumModel.getValue("id")).then((i=>{t.config.win.location=this.nsidOrPathAlias?"/photos/"+this.nsidOrPathAlias+"/albums/":""})).catch((t=>{throw e.error("Error deleting album",{err:t}),this.deleteConfirmButton.removeAttribute("disabled"),t}))}})}),"@VERSION@",{requires:["flickr-view","curation-edit-view"],optionalRequires:["hermes-core"],langBundles:["common","album-page","global-nav"]});YUI.add("hermes-template-photo-list-header",(function(n,t){var e=n.Template.Handlebars.revive({1:function(n,t,e,l,a){var s,o=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return null!=(s=o(e,"if").call(null!=t?t:n.nullContext||{},null!=t?o(t,"viewerCanEdit"):t,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.noop,data:a,loc:{start:{line:11,column:4},end:{line:16,column:11}}}))?s:""},2:function(n,t,e,l,a){var s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t\t<a role="button" class="action edit" tabindex="0">\n\t\t\t\t\t\t<svg class="icon icon-edit"><use xlink:href="#icon-edit"></use></svg>\n\t\t\t\t\t\t<span>'+n.escapeExpression((s(e,"intlMessage")||t&&s(t,"intlMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.EDIT"},data:a,loc:{start:{line:14,column:12},end:{line:14,column:51}}}))+"</span>\n\t\t\t\t\t</a>\n"},4:function(n,t,e,l,a){var s,o=null!=t?t:n.nullContext||{},i=n.hooks.helperMissing,c="function",r=n.escapeExpression,u=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t<a role="button" class="action '+r(typeof(s=null!=(s=u(e,"action")||(null!=t?u(t,"action"):t))?s:i)===c?s.call(o,{name:"action",hash:{},data:a,loc:{start:{line:19,column:34},end:{line:19,column:44}}}):s)+'" tabindex="0">\n\t\t\t\t<svg class="icon icon-'+r(typeof(s=null!=(s=u(e,"icon")||(null!=t?u(t,"icon"):t))?s:i)===c?s.call(o,{name:"icon",hash:{},data:a,loc:{start:{line:20,column:26},end:{line:20,column:34}}}):s)+'"><use xlink:href="#icon-'+r(typeof(s=null!=(s=u(e,"icon")||(null!=t?u(t,"icon"):t))?s:i)===c?s.call(o,{name:"icon",hash:{},data:a,loc:{start:{line:20,column:59},end:{line:20,column:67}}}):s)+'"></use></svg>\n\t\t\t\t<span>'+r(typeof(s=null!=(s=u(e,"label")||(null!=t?u(t,"label"):t))?s:i)===c?s.call(o,{name:"label",hash:{},data:a,loc:{start:{line:21,column:10},end:{line:21,column:19}}}):s)+"</span>\n\t\t\t</a>\n"},6:function(n,t,e,l,a){return" hidden"},8:function(n,t,e,l,a){var s=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'\t\t\t\t<span class="stats-separator">&middot;</span>\n\t\t\t\t<a role="button" class="stat comment-count">\n\t\t\t\t\t'+n.escapeExpression((s(e,"intlHTMLMessage")||t&&s(t,"intlHTMLMessage")||n.hooks.helperMissing).call(null!=t?t:n.nullContext||{},{name:"intlHTMLMessage",hash:{countString:null!=t?s(t,"commentCountString"):t,commentCount:null!=t?s(t,"commentCount"):t,intlName:"common.COMMENT_COUNT_FORMATTED"},data:a,loc:{start:{line:58,column:5},end:{line:58,column:123}}}))+"\n\t\t\t\t</a>\n"},compiler:[8,">= 4.3.0"],main:function(n,t,e,l,a){var s,o,i=null!=t?t:n.nullContext||{},c=n.hooks.helperMissing,r="function",u=n.escapeExpression,m=n.lookupProperty||function(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]};return'<div class="photo-list-header-action-bar">\n\t<div class="action-bar-content">\n\t\t<div class="back-link-container">\n\t\t\t<a class="back-link" href="'+u(typeof(o=null!=(o=m(e,"backUrl")||(null!=t?m(t,"backUrl"):t))?o:c)===r?o.call(i,{name:"backUrl",hash:{},data:a,loc:{start:{line:4,column:30},end:{line:4,column:41}}}):o)+'">\n\t\t\t\t<svg class="icon icon-back"><use xlink:href="#icon-back"></use></svg>\n\t\t\t\t<span>'+u(typeof(o=null!=(o=m(e,"backToMessage")||(null!=t?m(t,"backToMessage"):t))?o:c)===r?o.call(i,{name:"backToMessage",hash:{},data:a,loc:{start:{line:6,column:10},end:{line:6,column:27}}}):o)+'</span>\n\t\t\t</a>\n\t\t</div>\n\t\t<div class="actions">\n'+(null!=(s=m(e,"if").call(i,null!=t?m(t,"signedIn"):t,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:3},end:{line:17,column:10}}}))?s:"")+(null!=(s=m(e,"each").call(i,null!=t?m(t,"actions"):t,{name:"each",hash:{},fn:n.program(4,a,0),inverse:n.noop,data:a,loc:{start:{line:18,column:3},end:{line:23,column:12}}}))?s:"")+'\t\t\t<a role="button" class="action share" tabindex="0">\n\t\t\t\t<svg class="icon icon-share_hollow"><use xlink:href="#icon-share_hollow"></use></svg>\n\t\t\t\t<span>'+u((m(e,"intlMessage")||t&&m(t,"intlMessage")||c).call(i,{name:"intlMessage",hash:{intlName:"share-modal.FLICKR_SHARE"},data:a,loc:{start:{line:26,column:10},end:{line:26,column:62}}}))+'</span>\n\t\t\t</a>\n\t\t</div>\n\t</div>\n</div>\n\n<div role="main" class="photo-list-header-container">\n\t<section class="details-section">\n\t\t<header>\n\t\t\t<h1 class="title">'+u(typeof(o=null!=(o=m(e,"title")||(null!=t?m(t,"title"):t))?o:c)===r?o.call(i,{name:"title",hash:{},data:a,loc:{start:{line:35,column:21},end:{line:35,column:30}}}):o)+'</h1>\n\t\t\t<a role="button" class="read-more-title-button hidden" tabindex="0">'+u((m(e,"intlHTMLMessage")||t&&m(t,"intlHTMLMessage")||c).call(i,{name:"intlHTMLMessage",hash:{intlName:"common.DESCRIPTION_READ_MORE"},data:a,loc:{start:{line:36,column:71},end:{line:36,column:131}}}))+'</a>\n\t\t\t<a role="button" class="read-less-title-button hidden" tabindex="0">'+u((m(e,"intlMessage")||t&&m(t,"intlMessage")||c).call(i,{name:"intlMessage",hash:{intlName:"common.DESCRIPTION_READ_LESS"},data:a,loc:{start:{line:37,column:71},end:{line:37,column:127}}}))+"</a>\n\t\t\t<p>"+u((m(e,"renderTrustedMarkup")||t&&m(t,"renderTrustedMarkup")||c).call(i,null!=t?m(t,"byString"):t,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:38,column:6},end:{line:38,column:38}}}))+'</p>\n\t\t</header>\n\t\t<div class="description short'+(null!=(s=m(e,"if").call(i,null!=t?m(t,"shortDescription"):t,{name:"if",hash:{},fn:n.noop,inverse:n.program(6,a,0),data:a,loc:{start:{line:40,column:31},end:{line:40,column:69}}}))?s:"")+'">\n\t\t\t<p>\n\t\t\t\t'+u((m(e,"renderTrustedMarkup")||t&&m(t,"renderTrustedMarkup")||c).call(i,null!=t?m(t,"shortDescription"):t,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:42,column:4},end:{line:42,column:44}}}))+'\n\t\t\t</p>\n\t\t\t<a role="button" class="read-more-button hidden" tabindex="0">'+u((m(e,"intlHTMLMessage")||t&&m(t,"intlHTMLMessage")||c).call(i,{name:"intlHTMLMessage",hash:{intlName:"common.DESCRIPTION_READ_MORE"},data:a,loc:{start:{line:44,column:65},end:{line:44,column:125}}}))+'</a>\n\t\t\t<a role="button" class="read-less-button hidden" tabindex="0">'+u((m(e,"intlMessage")||t&&m(t,"intlMessage")||c).call(i,{name:"intlMessage",hash:{intlName:"common.DESCRIPTION_READ_LESS"},data:a,loc:{start:{line:45,column:65},end:{line:45,column:121}}}))+'</a>\n\t\t</div>\n\t\t<div class="stats">\n\t\t\t<span class="stat photo-count">\n\t\t\t\t'+u(typeof(o=null!=(o=m(e,"itemCountString")||(null!=t?m(t,"itemCountString"):t))?o:c)===r?o.call(i,{name:"itemCountString",hash:{},data:a,loc:{start:{line:49,column:4},end:{line:49,column:23}}}):o)+'\n\t\t\t</span>\n\t\t\t<span class="stats-separator">&middot;</span>\n\t\t\t<span class="stat view-count">\n\t\t\t\t'+u((m(e,"intlHTMLMessage")||t&&m(t,"intlHTMLMessage")||c).call(i,{name:"intlHTMLMessage",hash:{countString:null!=t?m(t,"viewCountString"):t,viewCount:null!=t?m(t,"viewCount"):t,intlName:"common.VIEW_COUNT_FORMATTED"},data:a,loc:{start:{line:53,column:4},end:{line:53,column:110}}}))+"\n\t\t\t</span>\n"+(null!=(s=m(e,"if").call(i,null!=t?m(t,"hasCommentStats"):t,{name:"if",hash:{},fn:n.program(8,a,0),inverse:n.noop,data:a,loc:{start:{line:55,column:3},end:{line:60,column:10}}}))?s:"")+"\t\t</div>\n\t</section>\n</div>"},useData:!0}),l={};n.Array.each([],(function(t){var e=n.Template.get("hermes/"+t);e&&(l[t]=e)})),n.Template.register("hermes/photo-list-header",(function(t,a){return(a=a||{}).partials=a.partials?n.merge(l,a.partials):l,e(t,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-list-header-view",(function(e,t){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},buildContainer:function(e){return this.setContainerWithTemplate("photo-list-header",e),this},activate:function(){var t=this.get("container");return this.actions=t.one(".actions"),this.descripNode=t.one(".description"),this.descripContentNode=this.descripNode.one("p"),this.readMoreButton=t.one(".read-more-button"),this.readLessButton=t.one(".read-less-button"),this.titleNode=t.one(".title"),this.readMoreTitleButton=t.one(".read-more-title-button"),this.readLessTitleButton=t.one(".read-less-title-button"),this.changeDescription(this.getDescription()),this.changeTitle(),this.actions&&(this.registerEventHandler(this.actions.delegate("click",this.handleActionClick.bind(this),".action")),this.registerEventHandler(this.actions.delegate("key",this.handleActionClick.bind(this),"down:13",".action"))),this.readMoreButton&&this.registerEventHandler(this.readMoreButton.on(["click","key"],this.handleReadMoreClick.bind(this),"down:13")),this.readLessButton&&this.registerEventHandler(this.readLessButton.on(["click","key"],this.handleReadLessClick.bind(this),"down:13")),this.readMoreTitleButton&&this.registerEventHandler(this.readMoreTitleButton.on(["click","key"],this.handleReadMoreTitleClick.bind(this),"down:13")),this.readLessTitleButton&&this.registerEventHandler(this.readLessTitleButton.on(["click","key"],this.handleReadLessTitleClick.bind(this),"down:13")),this.registerEventHandler(e.on("curationEdit:deleteCanceled",(e=>{setTimeout(this.showEditModal.bind(this),1)}))),this.registerEventHandler(e.globalEvents.subscribe("window:resize",this.handleResize.bind(this))),this},changeTitle:function(){this.titleNode.getDOMNode().scrollHeight>this.titleNode.getDOMNode().clientHeight+5?(this.titleNode.toggleClass("short",!0),this.readMoreTitleButton.toggleClass("hidden",!1)):(this.titleNode.toggleClass("short",!1),this.readMoreTitleButton.toggleClass("hidden",!0),this.readLessTitleButton.toggleClass("hidden",!0))},handleReadMoreTitleClick:function(){this.titleNode.toggleClass("short",!1),this.titleNode.toggleClass("expanded",!0),this.readMoreTitleButton.toggleClass("hidden",!0),this.readLessTitleButton.toggleClass("hidden",!1),this.readLessTitleButton.focus()},handleReadLessTitleClick:function(){this.titleNode.toggleClass("short",!0),this.titleNode.toggleClass("expanded",!1),this.readLessTitleButton.toggleClass("hidden",!0),this.readMoreTitleButton.toggleClass("hidden",!1),this.readMoreTitleButton.focus()},handleReadMoreClick:function(){this.toggleLongDescription(!0),this.readLessButton.focus()},handleReadLessClick:function(){this.toggleLongDescription(!1),this.readMoreButton.focus()},toggleLongDescription:function(e){this.descripNode.toggleClass("short",!e),e?(this.descripContentNode.setHTML(this.longDescription),this.readMoreButton.toggleClass("hidden",!0),this.readLessButton.toggleClass("hidden",!1)):(this.descripContentNode.setHTML(this.description),this.readMoreButton.toggleClass("hidden",!1),this.readLessButton.toggleClass("hidden",!0))},changeDescription:function(e){var t=!this.readLessButton.hasClass("hidden");this.description=e,this.description?(this.descripNode.removeClass("hidden"),this.longDescription=e.replace(/(\r\n|\n|\r)/gm,"<br>"),this.toggleLongDescription(!1),this.descripContentNode.setHTML(this.longDescription),this.descripContentNode.getDOMNode().scrollHeight>this.descripContentNode.getDOMNode().clientHeight?(this.descripNode.toggleClass("short-plus",!0),this.descripContentNode.getDOMNode().scrollHeight>this.descripContentNode.getDOMNode().clientHeight?t?(this.descripNode.toggleClass("short-plus",!1),this.toggleLongDescription(!0)):(this.descripNode.toggleClass("no-read-more",!1),this.descripNode.toggleClass("short-plus",!1),this.descripContentNode.setHTML(this.description)):this.descripNode.toggleClass("no-read-more",!0)):this.descripNode.toggleClass("no-read-more",!0)):this.descripNode.addClass("hidden")},handleResize:function(){this.changeDescription(this.description),this.changeTitle()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-list-header"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["common","share-modal"]});YUI.add("new-album-header-view",(function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["photo-list-header-view"],[],{langBundles:this.details.langBundles,initializer:function(e){return this.albumId=e.albumId,this.nsidOrPathAlias=e.nsidOrPathAlias,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=[],i=this.appContext.getViewer();return t.push(this.appContext.getModel("set-models",this.albumId).then((e=>{this.set("albumModel",e)}))),i.signedIn&&t.push(this.appContext.getModel("person-preferences-models",i.nsid).then((e=>{this.set("prefsModel",e)}))),e.Promise.all(t)},buildContainer:function(){var t=this.get("albumModel"),i=this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===t.getValue("owner").id,o="/photos/"+this.nsidOrPathAlias+"/albums/with/"+this.albumId,a="",s=[];t.getValue("canDownload")&&s.unshift({action:"download",icon:"download_hollow",label:this.intlMessage({intlName:"common.DOWNLOAD"})}),i?(s.unshift({action:"photobook",icon:"book",label:this.intlMessage({intlName:"wallet.ORDERS_PHOTO_BOOK"})}),a=this.intlMessage({intlName:"common.BY_YOU_WITH_URL",ownerUrl:t.getValue("owner").getValue("url")})):a=this.intlMessage({intlName:"common.BY_USER_WITH_URL",username:e.StringHelper.escapeHtml(t.getValue("owner").getValue("username")),userUrl:t.getValue("owner").getValue("url")});var n={actions:s,backUrl:o,backToMessage:this.intlMessage({intlName:"album-page.BACK_TO_ALBUMS"}),signedIn:this.appContext.getViewer().signedIn,viewerCanEdit:i&&!t.getValue("isAutoUploadSet"),title:t.getValue("title"),byString:a,shortDescription:t.getValue("description"),itemCountString:t.getValue("photoAndVideosDisplay"),viewCount:t.getValue("viewCount"),viewCountString:e.IntlNumber.format(t.getValue("viewCount"),this.appContext.lang,1)};return this.constructor.superclass.buildContainer.call(this,n)},activate:function(){var t=this.get("container"),i=this.get("albumModel"),o=this.get("prefsModel");this.actions=t.one(".actions"),this.downloadLink=this.actions.one(".action.download"),this.registerEventHandler(i.on("valuesChanged",(function(e){e.photoAndVideosDisplay&&t.one(".photo-count").set("text",e.photoAndVideosDisplay.newVal)}))),this.downloadLink&&(this.bulkDownloaderView=new e.BulkDownloaderView({appContext:this.appContext})),this.registerEventHandler(this.get("albumModel").on("valuesChanged",this.handleAlbumModelValuesChanged.bind(this))),e.on("albumToolbarView:layoutChange",(function(e){o&&(o.setValues({albumViewLayoutPref:e}),o.remoteUpdate())})),this.constructor.superclass.activate.call(this)},handleActionClick:function(e){e.target.ancestor(".action.share",!0)?this.showShareModal(e.target):e.target.ancestor(".action.download",!0)?this.downloadAlbum(e):e.target.ancestor(".action.photobook",!0)?this.createBookFromAlbum(e):e.target.ancestor(".action.edit",!0)&&this.showEditModal(e)},showShareModal:function(t){var i=new e.Views["fluid-share-album-view"]({appContext:this.appContext,albumId:this.albumId});i.initialize().then((function(){return i.prepareModal(t)}))},downloadAlbum:function(t){var i,o=this.get("albumModel");return this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===o.getValue("owner").id&&this.bulkDownloaderView.set("isOwnAlbum",!0),1===o.getValue("totalCount")?o.getValue("photoPageList").getPage({page:1,perPage:1}).then((t=>{var i,o,a,s=t[0];s.getValue("isVideo")&&!this.appContext.flipper.isFlipped("disable-video-playback")?o="/video_download.gne?id="+s.id:(i=(a=s.getLargestSize({excludeSizes:[]}).url.split(".")).pop(),0===(o=a.join(".")+"_d."+i).indexOf("//")&&(o="https:"+o)),e.config.doc.location.href=o})):o.getValue("totalCount")>e.config.flickr.downloadr.max_album_items?(e.rapidTracker.beacon(this.name,"albumDownloadTooMany"),this.onError(this.intlMessage({intlName:this.bulkDownloaderView.get("isOwnAlbum")?"downloadr.ALBUM_TOO_MANY_OWN":"downloadr.ALBUM_TOO_MANY_OTHER",username:o.getValue("owner").getValue("displayname"),userurl:o.getValue("owner").getValue("url"),url:"/photos/organize?start_tab=one_set"+o.id}))):(i=this.bulkDownloaderView.createTitle(o.getValue("photoCount"),o.getValue("videoCount")),void this.bulkDownloaderView.showDownloadDialog({title:i,setID:this.albumId}))},createBookFromAlbum:function(){this.appContext.flapp.navigate("/create")},getDescription:function(){return this.get("albumModel").getValue("description")},handleAlbumModelValuesChanged:function(e){var t=this.get("container"),i=t.one(".title"),o=t.one(".photo-count");e.title&&i&&(i.set("text",e.title.newVal),this.changeTitle()),e.description&&this.changeDescription(e.description.newVal),e.photoAndVideosDisplay&&o&&o.set("text",e.photoAndVideosDisplay.newVal)},showEditModal:function(){var t=this.get("albumModel"),i=new e.Views["album-edit-view"]({appContext:this.appContext,nsidOrPathAlias:this.nsidOrPathAlias,albumModel:t,title:this.intlMessage({intlName:"album-page.EDIT_ALBUM"}),curationTitle:this.storedEditMeta?this.storedEditMeta.title:t.getValue("title"),curationDescription:this.storedEditMeta?this.storedEditMeta.description:t.getValue("description"),coverPhotoId:this.storedCoverPhotoId?this.storedCoverPhotoId:t.getValue("primary"),deleteMessage:this.intlMessage({intlName:"album-page.DELETE_ALBUM"}),confirmDeleteMessage:this.intlMessage({intlName:"album-page.CONFIRM_ALBUM_DELETE_NO_CONTENTS_DELETED"})});this.storedEditMeta=null,this.editModal=new e.Views.FluidModal({appContext:this.appContext,subview:i,width:600,classList:["curation-edit-view"],focusOnFirstTabPress:!1,hasSubviewConfigRefactor:!0}).show(),i.registerEventHandler(e.on("curationEdit:coverPhotoClicked",(e=>{var t=this.storedCoverPhotoId;this.storedEditMeta=e.storedEditMeta,this.editModal.close(),setTimeout((()=>{this.storedCoverPhotoId=t,this.showPhotoPicker()}),1)}))),i.registerEventHandler(e.on("curationEdit:deleteClicked",(e=>{this.storedEditMeta=e.storedEditMeta,this.editModal.close()})))},showPhotoPicker:function(){var t=this.get("albumModel"),i={appContext:this.appContext,enableVideos:!0,searchable:{yours:!0}};i.defaultSelected={id:t.getValue("id"),title:t.getValue("title"),type:"set"};var o=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}],a=[{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0}],s=[{id:"sets",name:this.intlMessage({intlName:"common.ALBUMS"}),value:"sets",selected:!0},{id:"photostream",name:this.intlMessage({intlName:"common.PHOTOSTREAM"}),value:"photostream"},{id:"upload",name:this.intlMessage({intlName:"global-nav.UPLOAD"}),value:"upload"}];return this.appContext.getModel("photo-models",t.getValue("primary")).then((t=>{i.preSelectedPhotos=[t],i.navBarConfig={appContext:this.appContext,enableSearch:!0,links:s,breakpointConfig:[{maxWidth:700,links:o,enableSearch:!1},{maxWidth:500,links:a,enableSearch:!1}],onClose:e=>{this.photoPicker.close()}},i.onConfirm=e=>{var t=this.photoPicker.get("subview").get("selected");this.storedCoverPhotoId=t,this.photoPicker.close()},i.initialButtonState={confirm:""};let n=new e.Views["photo-selector-view"](i);this.photoPicker=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,subview:n,width:Math.round(.8*Math.max(1280,e.config.win.innerWidth)),height:Math.round(e.config.win.innerHeight-60),fullWindow:!0,classList:"photo-selector album-coverphoto-selector",hasSubviewConfigRefactor:!0,flexLayout:!0}).show(),this.photoPicker.registerEventHandler(e.on("photoSelector:selected",(e=>{n.confirmView.setButtonState({confirm:""})}))),this.photoPicker.registerEventHandler(e.on("photoSelector:unselected",(e=>{n.confirmView.setButtonState({confirm:"disabled"})}))),this.photoPicker.on("close",(()=>{setTimeout(this.showEditModal.bind(this),1)}))}))}})}),"@VERSION@",{requires:["flickr-view","album-edit-view","fluid-share-album-view","photo-list-header-view"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["common","album-page","wallet","global-nav"]});YUI.add("album-page-view",(function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.albumId=t.albumId,this.isOwner=t.isOwner,this.isTwitterbot=t.isTwitterbot,this.albumPhotoListLayoutStyle=t.albumPhotoListLayoutStyle,t.id=t.albumId,t.modelRegistryName="set-models",t.maxNumAttrName="totalCount",this.pageParams=t.pageParams,t.photoListConfig={modelParams:{registryName:"set-models",modelIdOrAttributes:t.albumId,collectionAttributeName:"photoPageList"},parentName:this.name,pageParams:t.pageParams,contextSuffix:"album-"+t.albumId,measureAFT:!0,maintainScrollPosition:!1,scrollToWithId:t.withPhotoId},this.appContext.flipper.isFlipped("enable-new-albums-header")?(this.photoCardHelper=new e.PhotoCardHelper(this.appContext),this.cardSubviewMapping={"photo-models":{name:"photo-card-view",isPhotoCard:!0,params:{showInfoBar:!0,showInfoBarTitle:!0,photoConfig:{shouldContain:!1,urlContext:"",isLargePaddedPhoto:!1,canRemovePhoto:this.isOwner}}}},t.photoListConfig.layout={targetRowHeight:"justified"===this.albumPhotoListLayoutStyle?280:500,targetRowHeightTolerance:.2,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:0,right:0,bottom:8,left:0},itemSpacing:{horizontal:32,vertical:32},additionalHeight:this.photoCardHelper.INFO_BAR_HEIGHT},t.photoListConfig.subviewMapping={...this.cardSubviewMapping},t.photoListConfig.isCardLayout=!0,t.photoListConfig.resizeThrottle=200):t.photoListConfig.layout={targetRowHeight:"justified"===this.albumPhotoListLayoutStyle?190:430,fullWidthBreakoutRowCadence:"justified"===this.albumPhotoListLayoutStyle?null:3,awakeBoundsToViewportSizeRatio:5,containerPadding:{top:4,right:0,bottom:4,left:0},itemSpacing:{horizontal:4,vertical:4}},this},subviewConfig:{"global-nav-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0},"album-toolbar-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"new-album-header-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0},"pagination-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0,disabled:function(){return!this.pageParams.viewPageSize}},"footer-full-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!0}},loadState:function(){var e=this;return this.appContext.getModel("set-models",this.albumId).then((function(t){e.set("albumModel",t)}))},buildContainer:function(){return this.setContainerWithTemplate("album-page"),this},buildHeadContainer:function(){var t,a,o,l=this.get("albumModel");l.registry?t=l.registry.getSizeToFit(this.albumId,{width:640,height:640}):i.error("Missing album model registry"),o=l.getValue("url").replace(/\/albums\/([0-9]+)/i,"/sets/$1"),a=this.templates("dynamic-page-head")({title:l.getValue("title"),description:l.getValue("description")||this.intlMessage({intlName:"album-page.OPENGRAPH_DESCRIPTION",owner:l.getValue("owner").getValue("displayname")}),url:l.getValue("url"),embedUrl:"/photosets/"+l.getValue("id"),fullURL:e.url(o),openGraphImageURL:t?e.URLHelper.addProtocolToURL(t.url):"",openGraphImageWidth:t?t.width:"",openGraphImageHeight:t?t.height:"",ownerURL:e.url(l.getValue("owner").getValue("url")),twitterCardType:"player",ogType:"article",domain:e.url(),feeds:[{title:this.intlMessage({intlName:"meta.ALBUM_ATOM_TITLE",username:l.getValue("owner").getValue("displayname"),albumTitle:l.getValue("title")}),url:"/services/feeds/photoset.gne?nsid="+l.getValue("owner").getValue("nsid")+"&set="+l.getValue("id")+"&lang="+this.appContext.lang.toLowerCase()+"&format=atom"}]}),a+=this.templates("head-article")({title:l.getValue("title"),url:e.url(o),ownerUrl:e.url(l.getValue("owner").getValue("url")),ownerName:l.getValue("owner").getValue("displayname"),photoUrl:t?e.URLHelper.addProtocolToURL(t.url):"",photoHeight:t?t.height:"",photoWidth:t?t.width:"",description:l.getValue("description")||this.intlMessage({intlName:"album-page.OPENGRAPH_DESCRIPTION",owner:l.getValue("owner").getValue("displayname")})}),a+=this.templates("head-meta")({isName:!0,metaName:"robots",metaValue:"noarchive"}),a+=this.templates("head-meta")({isName:!0,metaName:"viewport",metaValue:"width=device-width, viewport-fit=cover, initial-scale=1, maximum-scale=1"}),a+=this.templates("head-meta")({isName:!0,metaName:"googlebot",metaValue:"noarchive"}),YUI.Env.isServer?this.set("headContainer",a):(this.set("headContainer",a.concat(this.subviews["pagination-view"].get("headContainer"))),this.updateHead())},activate:function(){var t=this.get("albumModel"),i=t.getValue("isOwner");return e.later(100,this,(function(){e.use("photo-page-scrappy-view")})),e.on("albumToolbarView:layoutChange",(e=>{var t=this.subviews["photo-list-view"],i=t.photoListLayout;this.appContext.flipper.isFlipped("enable-new-albums-header")?i.targetRowHeight="justified"===e?280:500:i.targetRowHeight="justified"===e?190:430,i.fullWidthBreakoutRowCadence="justified"===e?null:3,t.setItems(this.get("albumModel").getValue("photoPageList").getList())})),e.on("albumEdit:primaryPhotoIsNewToAlbum",(()=>{this.refreshPhotoList()})),i||this.appContext.getViewCounter().recordAlbumView({albumOwnerID:t.getValue("owner").getValue("id"),albumID:t.getValue("id"),referrer:this.appContext.getReferrer()}),this.appContext.flipper.isFlipped("enable-photolist-scroll-history-with-url")||this.registerEventHandler(this.appContext.flapp.before("navigate",function(e){var t=e.details[0].url;if(t){var i=window.location.href,a=i.indexOf("/page"),o=-1!==(a=-1===a?i.indexOf("/with"):a)?i.substring(0,a):i,l=t.split("/"),r=l.indexOf("photos")+2,s=r<l.length?l[r]:null,n=s.match(/[0-9]+/);s&&n&&n[0].length===s.length&&history.replaceState(history.state,null,`${o}/with/${s}`)}}.bind(this))),this},onSubviewEvent:function(e,t){if(t&&"newPhotoAddedToAlbum"===t[0])this.subviews["photo-list-view"].resetToFirstPage();else if(t&&"handleRemovePhoto"===t[0]){var i=t[1];this.handleRemovePhoto(i)}},getAdditionalSpContexts:function(){var t={id:this.get("albumModel").getValue("id"),photoIds:[]};return e.Snowplough.getAlbumContext(t)},handleRemovePhoto:function(t){let i=new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"album-page.REMOVE_PHOTO_TITLE"}),htmlMessage:this.intlMessage({intlName:"album-page.REMOVE_PHOTO_MESSAGE"}),showCloseXButton:!1,fireModalActionClick:!1,onConfirm:async e=>(i.setLoading(!0),this.get("albumModel").removePhotoRemote(t).then((()=>{a.close(),this.refreshPhotoList()})))}),a=new e.Views.FluidModal({appContext:this.appContext,subview:i,hasSubviewConfigRefactor:!0}).show()},refreshPhotoList:function(){this.subviews["photo-list-view"].setItems(this.get("albumModel").getValue("photoPageList").getList())}})}),"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","set-models","hermes-template-album-page","hermes-template-dynamic-page-head","hermes-template-head-meta","hermes-template-head-link","hermes-template-head-article","album-toolbar-view","album-header-view","new-album-header-view","photo-list-view","footer-full-view","url-helper","url"],optionalRequires:["hermes-core"],langBundles:["album-page","meta"]});