YUI.add("slideshow-well-view",(function(e,t){var i=require("hermes-core/flog")(t);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){var t=e.collection.getList()[e.position];if(!t)throw new Error("missing photo");return this.set("photo",t),this.set("isActiveViewAgnostic",!0),this.set("canvasSizeIsDirty",!0),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},buildContainer:function(){var e,t,o=this,n=this.get("photo");return o.preloadImage&&(o.preloadImage.onload=null),this.appContext.forceServerRender?t=e=this.getPhotoForDisplay(n,{canvas:{width:Number.MAX_VALUE,height:Number.MAX_VALUE}}):(e=this.getPhotoForDisplay(n),t=this.getPhotoForDisplay(n,{includeSizes:["sq","q","t","s","n"]})),this.setContainerWithTemplate("photo-well-media-scrappy",{width:e.width,height:e.height,src:t.url,highResSrc:e.url,showFuzzy:n.getValue("needsInterstitial"),isSignedIn:this.appContext.getViewer().signedIn,isVideo:!1}),YUI.Env.isServer?(this.serverWidth=e.width,this.serverHeight=e.height):n.getValue("needsInterstitial")||this.preloadPhoto(n).then((function(){var e=o.get("container").one(".low-res-photo"),t=o.get("container").one(".main-photo");t&&t.removeClass("is-hidden").show(),e&&e.hide()})).catch((function(e){i.error("Error building slideshow",{err:e})})),this},preloadPhoto:function(t){var i=this;return new e.Promise((function(e,o){return i.generatePhotoElement(t,e,o)}))},generateFuzzyElement:function(e){var t,i;return t=this.getPhotoForDisplay(e),(i=document.createElement("span")).style.width=t.width+"px",i.style.height=t.height+"px",i},generatePhotoElement:function(t,i,o){var n,r;return n=this.getPhotoForDisplay(t),(r=new Image).src=n.url,r.width=n.width,r.height=n.height,r.complete&&i&&"function"==typeof i&&i(t),r=e.one(r),i&&"function"==typeof i&&r.once("load",(function(){i(t),r.detachAll(),r=void 0})),o&&"function"==typeof o&&r.once("error",(function(){o(t),r.detachAll(),r=void 0})),r},handlePhotoLoaded:function(e){this.fire("subviewViewEvent","photoLoaded"),e.getValue("isOwner")||this.appContext.getViewCounter().queue(e.getValue("id"),this.appContext.getReferrer())},swapPhoto:function(t,i){var o,n,r;(r=this.get("container").one(".restricted-image"))&&(n=!0),t.getValue("needsInterstitial")?((o=this.generateFuzzyElement(t)).className="main-photo outro restricted-image",o=e.one(o),r=this.get("container").one(".main-photo"),i||(r.once("transitionend",(function(){r.detach(),r&&r.remove(!0),r=void 0})),r.removeClass("main-photo"),r.removeClass("intro"),r.addClass("outro"),o.removeClass("outro"),o.addClass("intro")),r.insert(o,"before"),i&&(o.removeClass("outro"),r.remove(!0)),this.fire("subviewViewEvent","photoLoaded")):(o=this.generatePhotoElement(t,this.handlePhotoLoaded.bind(this)),n||(r=this.get("container").one(".main-photo")),o.addClass("main-photo"),o.addClass("outro"),r&&r.removeClass("main-photo"),i?(o&&o.removeClass("outro"),r&&(r.insert(o,"before"),r.remove(!0))):(r&&(r.once("transitionend",(function(){r.detachAll(),r&&r.remove(!0),r=void 0})),r.addClass("outro"),r.removeClass("intro"),r.insert(o,"before")),o&&(o.removeClass("outro"),o.addClass("intro"))))},onParentViewEvent:function(e,t){if(t&&t[0])switch(t[0]){case"photoWellResized":this.get("photo").getValue("needsInterstitial")||this.buildContainer();break;case"slideshowView:newPhoto":t[1]&&(this.set("photo",t[1]),this.swapPhoto(t[1],t[2]));break;case"slideshowView:preloadPhoto":t[1]&&this.preloadPhoto(t[1])}},activate:function(){var t=this;return this.get("photo").getValue("needsInterstitial")||(this.registerEventHandler(e.on("flickr:photo-media-well-update",(function(e){t.buildContainer()}))),e.use("global-events",(function(e){t.registerEventHandler(e.globalEvents.subscribe("window:resize",(function(e){t.buildContainer()})))}))),this.appContext.getViewer().signedIn&&this.appContext.getModel("person-preferences-models",t.appContext.auth.user.nsid).then((function(e){t.set("personPreferences",e),t.get("photo").getValue("needsInterstitial")&&!this.appContext.getViewer().isMinor&&t.registerEventHandler(t.get("container").one(".restricted-interstitial-message button").on("click",t.handleInterstitialDismissButtonClick,t))})),this},getPhotoForDisplay:function(e,t){var i,o,n,r=this.getCanvasSize(),s=this.getPixelRatio();return t&&t.canvasSize&&(r=t.canvasSize),i=e.getSizeToFit(r,t),o=r.height/s,n=Math.min(r.width/s,i.width/i.height*o),o=Math.min(o,i.height/i.width*n),{width:Math.round(n),height:Math.round(o),url:i.url,pixelRatio:i.width/n}},getCanvasSize:function(){var t,i,o=this.getPixelRatio(),n={width:500,height:500};return this.get("canvasSizeIsDirty")?YUI.Env.isServer||(i=e.one("#content"))&&((t=i.get("region")).height=e.config.win.innerHeight,t.width=e.config.win.innerWidth):t=this.get("cachedCanvasSize"),this.appContext.viewportData.viewport.width>0&&(n={width:this.appContext.viewportData.viewport.width,height:this.appContext.viewportData.viewport.height-240}),t||(t={top:0,left:0,bottom:500,right:500,width:n.width,height:n.height}),t.height*=o,t.width*=o,t},getPixelRatio:function(){return this.appContext.getViewer().getPixelRatio()}},{})}),"@VERSION@",{requires:["flickr-view","hermes-template-photo-well-media-scrappy"],optionalRequires:["hermes-core"],langBundles:["common","photo-page-scrappy"]});YUI.add("slideshow-view",(function(e,t){var i=require("hermes-core/flog")(t);e.namespace("Views").Slideshow=e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){if(this.set("isActiveViewAgnostic",!0),this.collection=e.collection,this.pageParams=e.pageParams||{perPage:20},this.pageParams.page=parseInt(e.pageNumber,10)||1,this.position=parseInt(e.position,10)||0,this.collection.totalItems<1)throw new Error("no items in collection");return""===this.get("container").getHTML()&&this.setContainerWithTemplate("flickr-balls"),this},subviewConfig:{"slideshow-attribution-view":{isActiveViewAgnostic:!0,requiredToShowOnClient:!1,requiredToShowOnServer:!1,additionalViewClasses:["is-real-fullscreen","photo-attribution"]},"slideshow-well-view":{isActiveViewAgnostic:!0,requiredToShowOnClient:!1,requiredToShowOnServer:!1,dealbreaker:!0}},loadState:function(){var e=this;return this.collection.getPage(this.pageParams).then((function(){var t,s,n,a=e.collection.getList();if(!a[e.position])throw new Error("The starting photo does not exist.");if(t=parseInt(e.collection.totalItems,10),e.bufferPhotos(e.position,e.get("bufferSize")),s=t-1,(n=e.position-1)<0&&(n=s),!a[n])return e.pageParams.page=Math.ceil(n/e.pageParams.perPage),e.collection.getPage(e.pageParams).then((function(){e.bufferPhotos(e.position,e.get("bufferSize"),"prev")})).catch((function(e){i.error("Error fetching next page in collection",{err:e})}))})).catch((function(t){i.error("Error initializing slideshow",{err:t}),e.close()}))},buildContainer:function(){var e;return this.subviews["slideshow-attribution-view"]&&(e=this.subviews["slideshow-attribution-view"].get("container")),this.setContainerWithTemplate("slideshow",{"slideshow-attribution-view":e,"photo-well-view":this.subviews["slideshow-well-view"].get("container")}),this},freeze:function(){e.one("body").setStyles({overflow:"hidden"})},unfreeze:function(){e.one("body").setStyles({overflow:"visible"})},show:function(){var t=this,s=e.one("#content");return e.use("d3",(function(){if(s){s.append(t.get("container")),t.get("enableFullscreen")&&(t.fullScreenManager=new e.fluid.Fullscreen,t.fullScreenManager.on("enterFullscreen",t.finishInitialization.bind(t)),t.fullScreenManager.enterFullscreen());try{t.initialize().then((function(){t.finishInitialization()})).catch((function(e){i.error("Error initializing slideshow",{err:e}),t.close()}))}catch(e){i.error("Error initializing slideshow",{err:e}),t.close()}e.fire("flickr:setKeyEventScope",t.getKeyEventScope()),t.freeze()}else i.error("Error initializing slideshow: missing content div")})),this},close:function(t){var i=this.get("container");e.fire("flickr:removeKeyEventScope",this.getKeyEventScope()),this.get("enableFullscreen")&&(this.fullScreenManager.exitFullscreen(),this.fullScreenManager.destroy()),i&&i.remove(!0),this.unfreeze(),this.fire("close",t),clearTimeout(this.mouseMoveTimer),clearTimeout(this.initialFadeTimer),clearTimeout(this.timer),clearTimeout(this.movingFadeTimer),this.destroy({remove:!0})},removeCircleTimer:function(){var t=e.d3.select(".timer > svg");t=t.remove()},drawCircleTimer:function(){var t,i,s,n={},a=this.get("autoplayInterval"),o=".timer",r=this.get("container").one(o);n.width=r.get("clientWidth"),n.height=r.get("clientHeight"),t=e.d3.svg.arc().innerRadius(35).outerRadius(40),i=e.d3.scale.linear().range([0,360]).domain([0,360]),s=e.d3.range(i(360)).map((function(e,t){return{startAngle:(t*=2)*(Math.PI/360),endAngle:(t+2)*(Math.PI/360)}})),e.d3.select(o).append("svg").attr("class","arc-timer").attr("width",n.width).attr("height",n.height).append("g").attr("transform","translate("+n.width/2+", "+n.height/2+")").append("g").selectAll("path").data(s).enter().append("path").attr("fill",(function(e){return"#fff"})).transition().delay((function(e,t){return t*a/s.length})).duration(a/s.length).ease("linear").attrTween("d",(function(i){var s=e.d3.interpolate(i.startAngle,i.endAngle);return function(e){return i.endAngle=s(e),t(i)}}))},getNextSafePhoto:function(e,t){var i,s;if(i=this.collection.getList(),s=parseInt(this.collection.totalItems,10),"next"===(t=t||"next")){if((e+=1)===s){if(!this.collection.fetchedEnd)return;e=0}}else if(-1===(e-=1)){if(!this.collection.fetchedEnd)return;e=s-1}return i[e]?e:e===this.position?-1:this.getNextSafePhoto(e,t)},handlePhotoChange:function(e,t){var s,n,a,o,r;s=this.collection.getList(),a=parseInt(this.collection.totalItems,10)-1,e=e||"next",(o=this.getNextSafePhoto(this.position,e))>-1&&(this.position=o),"next"===e?(n=this.position+this.pageParams.perPage)>a&&(n-=a):(n=this.position-this.pageParams.perPage)<0&&(n=a),r=s[this.position],this.fire("parentViewEvent","slideshowView:newPhoto",r,t),s[n]||(this.pageParams.page=Math.ceil(n/this.pageParams.perPage),this.collection.getPage(this.pageParams).catch((function(e){i.error("Error fetching next page in collection",{err:e})}))),this.bufferPhotos(this.position,this.get("bufferSize"),e)},bufferPhotos:function(e,t,i){var s,n,a;if(a=this.collection.getList(),n=parseInt(this.collection.totalItems,10),i=i||"next",t>0&&("next"===i?(e+=1)===n&&(e=0):(e-=1)<0&&(e=n-1),s=a[e]))return this.fire("parentViewEvent","slideshowView:preloadPhoto",s),t-=1,this.bufferPhotos(e,t,i)},handleKeys:function(t){var i=t.button;37===i||74===i?(e.rapidTracker.beacon(this.name,"keyboardLeft"),t.halt(),this.handleNavigation("prev",!0)):39===i||75===i||13===i?(e.rapidTracker.beacon(this.name,"keyboardRight"),t.halt(),this.handleNavigation("next",!0)):32===i?(e.rapidTracker.beacon(this.name,"keyboardPause"),t.halt(),this.handlePlayPause(this.get("container").one(".playpause"))):27===i?(e.rapidTracker.beacon(this.name,"keyboardEsc"),t.halt(),this.close()):t.halt()},handleNavigation:function(e,t){this.handlePhotoChange(e,t),clearTimeout(this.movingFadeTimer),this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer"))},handlePlayPause:function(e){this.showChrome(),this.toggleAutoplay()},handleClick:function(t){var i,s=t.target;s.hasClass("navigate-target")?(e.rapidTracker.beacon(this.name,"mouseNav"),t.halt(),i=s.getData("direction"),this.handleNavigation(i,!0)):s.hasClass("playpause")?(e.rapidTracker.beacon(this.name,"mousePlayPause"),t.halt(),this.handlePlayPause(s)):s.hasClass("close")&&(e.rapidTracker.beacon(this.name,"mouseClose"),t.halt(),this.close())},getKeyEventScope:function(){return this.name+this._yuid},cycle:function(){clearTimeout(this.timer),this.removeCircleTimer(),this.timer=setTimeout(this.handlePhotoChange.bind(this),this.get("autoplayInterval")),this.drawCircleTimer()},pauseAutoplay:function(){var t=this.get("container").one(".playpause");e.rapidTracker.beacon(this.name,"pauseAutoplay"),clearTimeout(this.timer),this.isPlaying=!1,this.removeCircleTimer(),t.removeClass("playing"),t.addClass("paused")},startAutoplay:function(){var t=this.get("container").one(".playpause");e.rapidTracker.beacon(this.name,"startAutoplay"),this.isPlaying=!0,this.cycle(),t.removeClass("paused"),t.addClass("playing")},toggleAutoplay:function(){this.isPlaying?this.pauseAutoplay():this.startAutoplay()},showChrome:function(){clearTimeout(this.movingFadeTimer),this.isShowingChrome=!0,this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer")),this.get("container").removeClass("idle")},handleMouseMove:function(e){if(this.isShowingChrome)return this.startPoint={x:e.pageX,y:e.pageY},clearTimeout(this.movingFadeTimer),void(this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer")));this.startPoint?(clearTimeout(this.mouseMoveTimer),clearTimeout(this.initialFadeTimer),Math.round(Math.sqrt(Math.pow(this.startPoint.y-e.pageY,2)+Math.pow(this.startPoint.x-e.pageX,2)))>this.get("chromeTriggerRadius")&&this.showChrome(),this.mouseMoveTimer=setTimeout(this.resetMouseDistance.bind(this),this.get("mouseIdleTimer"))):this.startPoint={x:e.pageX,y:e.pageY}},resetMouseDistance:function(){this.startPoint=null},handleMouseIdle:function(){var t;this.startPoint&&(t=e.one(document.elementFromPoint(this.startPoint.x,this.startPoint.y)))&&t.ancestor((function(e){return e.hasClass("chrome")}),!0)?this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer")):this.hideChrome()},hideChrome:function(){this.resetMouseDistance(),this.get("container").addClass("idle"),this.isShowingChrome=!1,clearTimeout(this.movingFadeTimer)},onSubviewEvent:function(e,t){"slideshow-well-view"===e&&"photoLoaded"===t[0]?this.isPlaying&&this.cycle():"slideshow-attribution-view"!==e||"isOpen"!==t[0]&&"personMenuOpen"!==t[0]?"slideshow-attribution-view"!==e||"isClosed"!==t[0]&&"personMenuClose"!==t[0]||(this.movingFadeTimer=setTimeout(this.handleMouseIdle.bind(this),this.get("fadeTimer"))):(clearTimeout(this.movingFadeTimer),clearTimeout(this.initialFadeTimer),this.pauseAutoplay())},finishInitialization:function(){!this.finished&&this.get("enableFullscreen")&&this.fullScreenManager.isInFullscreenMode()?this.finished=!0:(this.get("autoplay")&&this.startAutoplay(),this.initialFadeTimer=setTimeout(this.hideChrome.bind(this),1500))},activate:function(){var t=this.get("container");return this.registerEventHandler(t.on("click",this.handleClick,this)),this.registerEventHandler(this.appContext.flapp.before("activeViewChange",this.close.bind(this))),this._params&&(this._params.keyEventScope=this.getKeyEventScope()),this.attachKeyEvent("down:8,13,27,32,37,74,39,75",e.betterThrottle(this.handleKeys.bind(this),100)),this.get("enableFullscreen")&&this.registerEventHandler(this.fullScreenManager.on("exitFullscreen",this.close.bind(this))),this.registerEventHandler(e.one("body").on("mousemove",e.betterThrottle(this.handleMouseMove.bind(this)))),this}},{ATTRS:{autoplay:{value:!0},autoplayInterval:{value:5e3},fadeTimer:{value:2e3},mouseIdleTimer:{value:200},chromeTriggerRadius:{value:30},bufferSize:{value:2},enableFullscreen:{value:!0}}})}),"@VERSION@",{requires:["flickr-view","hermes-template-slideshow","slideshow-attribution-view","slideshow-well-view"],optionalRequires:["fluid-fullscreen","hermes-core"],langBundles:["common","photo-page-scrappy"]});YUI.add("fluid-fullscreen",(function(e){"use strict";function n(){var n=e.config.doc;return n.fullscreenEnabled||n.webkitFullscreenEnabled||n.mozFullScreenEnabled||n.msFullscreenEnabled}function l(){var n=e.config.doc;return n.fullscreenElement||n.webkitFullscreenElement||n.mozFullScreenElement||n.msFullscreenElement}e.mix(e.Node.DOM_EVENTS,{fullscreenchange:!0,webkitfullscreenchange:!0,mozfullscreenchange:!0,MSFullscreenChange:!0}),e.namespace("fluid").Fullscreen=function(){this.fullscreenChangeHandler=e.on("fullscreenchange",this.handleFullscreenChange.bind(this)),this.webkitFullscreenChangeHandler=e.on("webkitfullscreenchange",this.handleFullscreenChange.bind(this)),this.mozFullscreenChangeHandler=e.on("mozfullscreenchange",this.handleFullscreenChange.bind(this)),this.msFullscreenChangeHandler=e.on("MSFullscreenChange",this.handleFullscreenChange.bind(this)),this.publish("enterFullscreen"),this.publish("exitFullscreen")},e.fluid.Fullscreen.prototype={isFullscreenCapable:n,isInFullscreenMode:l,enterFullscreen:function(l){var r=e.config.doc.documentElement;if(l&&(r=l.getDOMNode()),n()){if(r.requestFullscreen)return r.requestFullscreen();if(r.webkitRequestFullscreen)return r.webkitRequestFullscreen();if(r.mozRequestFullScreen)return r.mozRequestFullScreen();if(r.msRequestFullscreen)return r.msRequestFullscreen()}return!1},exitFullscreen:function(){var n=e.config.doc;if(l()){if(n.exitFullscreen)return n.exitFullscreen();if(n.webkitExitFullscreen)return n.webkitExitFullscreen();if(n.mozCancelFullScreen)return n.mozCancelFullScreen();if(n.msExitFullscreen)return n.msExitFullscreen()}return!1},handleFullscreenChange:function(){this.isInFullscreenMode()?this.fire("enterFullscreen"):this.fire("exitFullscreen")},destroy:function(){this.fullscreenChangeHandler.detach(),this.webkitFullscreenChangeHandler.detach(),this.mozFullscreenChangeHandler.detach(),this.msFullscreenChangeHandler.detach()}},e.augment(e.fluid.Fullscreen,e.EventTarget,!0,null,{prefix:"fullscreen"})}),"@VERSION@",{requires:["event-custom"],optional:[],affinity:"client"});YUI.add("fluid-magic-slideshow-view",(function(i){i.namespace("Views")[this.name]=i.Base.create("fluid-magic-slideshow-view",i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this.nsid=e.nsid,this.modelParams=e.photoListConfig.modelParams,this.pageParams=e.pageParams,this.modelParams.fetchParams&&(this.pageParams=i.merge(this.modelParams.fetchParams,this.pageParams)),this.pageParams.viewPageSize?this.positionMultipler=this.pageParams.viewPageSize:this.positionMultipler=this.pageParams.perPage,this},loadState:function(){var i=this;return this.appContext.getModel(this.modelParams.registryName,this.modelParams.modelIdOrAttributes,this.modelParams.fetchParams).then((function(e){i.position=(i.pageParams.nominalPage-1)*i.positionMultipler||0,i.collection=e.getValue("photoPageList"),i.isEnabled=i.collection.totalItems>0})).catch((function(i){}))},buildContainer:function(){return this.setContainerWithTemplate("fluid-magic-slideshow",{isEnabled:this.isEnabled}),this},toggleSlideshow:function(e){i.rapidTracker.beacon(this.name,"launchSlideshow"),e.halt(),new i.Views.Slideshow({appContext:this.appContext,collection:this.collection,pageParams:this.pageParams,position:this.position}).show()},activate:function(){return this.isEnabled&&this.registerEventHandler(this.get("container").one(".slideshow-toggle").on("click",this.toggleSlideshow.bind(this))),this}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-fluid-magic-slideshow","slideshow-view"],langBundles:["common"]});YUI.add("hermes-template-reorder-grid-modal-view",(function(t,n){var e=t.Template.Handlebars.revive({1:function(t,n,e,l,a){return'\t\t<div class="sort-dropdown-container">\n\t\t\t<div role="button" class="sort-tooltip-button">\n\t\t\t\t<svg class="icon icon-info_hollow"><use xlink:href="#icon-info_hollow"></use></svg>\n\t\t\t</div>\n\t\t\t<div role="button" class="sort-dropdown-button">\n\t\t\t\t<div class="menu-title"></div>\n\t\t\t\t<div class="arrow">\n\t\t\t\t\t<svg class="icon icon-dropdown_arrow"><use xlink:href="#icon-dropdown_arrow"></use></svg>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n'},compiler:[8,">= 4.3.0"],main:function(t,n,e,l,a){var r,o,i=null!=n?n:t.nullContext||{},s=t.hooks.helperMissing,d=t.escapeExpression,c="function",u=t.lookupProperty||function(t,n){if(Object.prototype.hasOwnProperty.call(t,n))return t[n]};return"<header>\n\t<h1>"+d((u(e,"intlMessage")||n&&u(n,"intlMessage")||s).call(i,{name:"intlMessage",hash:{intlName:"reorder.REORDER_ITEMS"},data:a,loc:{start:{line:2,column:5},end:{line:2,column:53}}}))+"</h1>\n"+(null!=(r=u(e,"if").call(i,null!=n?u(n,"hasSortMenu"):n,{name:"if",hash:{},fn:t.program(1,a,0),inverse:t.noop,data:a,loc:{start:{line:3,column:1},end:{line:15,column:8}}}))?r:"")+'</header>\n\n<div class="reorder-grid-container">\n\t'+d((u(e,"outlet")||n&&u(n,"outlet")||s).call(i,null!=n?u(n,"reorder-grid-view"):n,{name:"outlet",hash:{},data:a,loc:{start:{line:19,column:1},end:{line:19,column:29}}}))+'\n\t<div class="loading-balls hidden">\n'+(null!=(r=t.invokePartial(u(l,"flickr-balls"),n,{name:"flickr-balls",data:a,indent:"\t\t",helpers:e,partials:l,decorators:t.decorators}))?r:"")+'\t</div>\n</div>\n<div class="drag-interaction-container">\n\t<div class="text-container">\n\t\t<span class="drag-tip">'+d((u(e,"renderTrustedMarkup")||n&&u(n,"renderTrustedMarkup")||s).call(i,null!=n?u(n,"dragTipHtml"):n,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:26,column:25},end:{line:26,column:60}}}))+'</span>\n\t\t<span class="drag-error hidden">'+d((u(e,"renderTrustedMarkup")||n&&u(n,"renderTrustedMarkup")||s).call(i,null!=n?u(n,"dragErrorHtml"):n,{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:27,column:34},end:{line:27,column:71}}}))+'</span>\n\t</div>\n\t<div class="button-container">\n\t\t<button class="mini alt cancel-button">'+d(typeof(o=null!=(o=u(e,"cancelText")||(null!=n?u(n,"cancelText"):n))?o:s)===c?o.call(i,{name:"cancelText",hash:{},data:a,loc:{start:{line:30,column:41},end:{line:30,column:55}}}):o)+'</button>\n\t\t<button class="mini confirm-button" disabled>'+d(typeof(o=null!=(o=u(e,"confirmText")||(null!=n?u(n,"confirmText"):n))?o:s)===c?o.call(i,{name:"confirmText",hash:{},data:a,loc:{start:{line:31,column:47},end:{line:31,column:62}}}):o)+"</button>\n\t</div>\n</div>\n"},usePartial:!0,useData:!0}),l={};t.Array.each(["flickr-balls"],(function(n){var e=t.Template.get("hermes/"+n);e&&(l[n]=e)})),t.Template.register("hermes/reorder-grid-modal-view",(function(n,a){return(a=a||{}).partials=a.partials?t.merge(l,a.partials):l,e(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("hermes-template-reorder-grid-view",(function(e,r){var a=e.Template.Handlebars.revive({compiler:[8,">= 4.3.0"],main:function(e,r,a,t,i){var l,n=e.lookupProperty||function(e,r){if(Object.prototype.hasOwnProperty.call(e,r))return e[r]};return'<div class="drag-list-container">\n\t\n</div>\n<div class="loading-indicator hidden">\n'+(null!=(l=e.invokePartial(n(t,"flickr-balls"),r,{name:"flickr-balls",data:i,indent:"\t",helpers:a,partials:t,decorators:e.decorators}))?l:"")+"</div>\n"},usePartial:!0,useData:!0}),t={};e.Array.each(["flickr-balls"],(function(r){var a=e.Template.get("hermes/"+r);a&&(t[r]=a)})),e.Template.register("hermes/reorder-grid-view",(function(r,i){return(i=i||{}).partials=i.partials?e.merge(t,i.partials):t,a(r,i)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("reorder-grid-view",(function(e,t){require("hermes-core/flog")(t);var r=200;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.reorderHelper=e.reorderHelper,this.layout=this.reorderHelper.layout,this.layout.maxWidth=this.layout.maxWidth||100,this.layout.itemSpacing=this.layout.itemSpacing||8,this.movedItems=[],this.perRow=1,this.cardWidth=1,this.mouseLeaveTimeouts={}},loadState:function(){return this.reorderHelper.load()},loadMore:async function(){if(!this.isLoadingMore){this.isLoadingMore=!0,this.loadingIndicator.removeClass("hidden");try{const e=await this.reorderHelper.loadMore();this.appendNewItems(e)}catch(e){return Promise.resolve()}finally{this.isLoadingMore=!1,this.loadingIndicator.addClass("hidden")}}},buildContainer:function(){this.setContainerWithTemplate("reorder-grid-view",{})},activate:function(){var t=this,r=this.get("container");this.scrollContainer=r.ancestor(".reorder-grid-container"),this.loadingIndicator=r.one(".loading-indicator"),this.dragContainer=this.get("container").one(".drag-list-container"),this.containerHeight=this.scrollContainer.get("clientHeight"),this.prepareItems(),this.registerEventHandler(e.globalEvents.subscribe("window:resize",(function(e){t.positionNodes()}))),this.registerEventHandler(e.on("reorderGridModal:doneClicked",this.handleDoneClick.bind(this))),this.registerEventHandler(this.scrollContainer.on("scroll",e.betterThrottle(this.handleScroll.bind(this),100,this,!1))),this.registerEventHandler(this.scrollContainer.on("scroll",e.betterThrottle(this.updateDeferredImages.bind(this),200,this,!0))),this.handleScroll(),this.updateDeferredImages(),this.throttledDragOver=e.betterThrottle(this.calculateDragOver.bind(this),200,t,!1)},prepareItems:async function(){let t=this;this.dragNodes=[],await this.loadMore(),this.dragStartId||(this.dragStartId=this.registerEventHandler(this.dragContainer.delegate("dragstart",this.handleDragStart.bind(this),".drag-item")),this.dragOverId=this.registerEventHandler(this.dragContainer.delegate("dragover",this.handleDragOver.bind(this),".drag-item")),this.dragEndId=this.registerEventHandler(this.dragContainer.delegate("dragend",this.handleDragEnd.bind(this),".drag-item")),this.dropId=this.registerEventHandler(this.dragContainer.delegate("drop",this.handleDrop.bind(this),".drag-item")),this.registerEventHandler(this.dragContainer.delegate("mouseenter",this.handleItemMouseEnter.bind(this),".drag-drop-item")),this.registerEventHandler(this.dragContainer.delegate("mouseleave",this.handleItemMouseLeave.bind(this),".drag-drop-item")),this.pageDragOverId=this.registerEventHandler(e.on("dragover",e.betterThrottle(this.handlePageDragOver.bind(this),r,this,!1))),this.dragId=this.registerEventHandler(this.dragContainer.delegate("drag",e.betterThrottle(this.handleDrag.bind(this),r,this,!1),".drag-item")),e.use("anim",(function(e){t.YAnim=e})))},appendNewItems:function(e){var t=this;e.forEach((function(r,i){const a=t.reorderHelper.getItemTemplate(r,t.cardWidth);let d=t.dragContainer.appendChild(a);t.dragNodes.push(d),d.setAttribute("draggable",!0),d.addClass("drag-item"),d.setAttribute("data-item-id",e[i].id)})),this.positionNodes()},handleDragStart:function(e){var t,r,i,a=this,d=e._event;d.target;for(this.currentDragNode=e.target.ancestor(".drag-item",!0),t=0;t<this.dragNodes.length;t++)this.dragNodes[t].getAttribute("data-item-id")===this.currentDragNode.getAttribute("data-item-id")&&(this.currentDragNodeInitialIndex=t,this.currentDragNodeIndex=t);d.dataTransfer.effectAllowed="move",d.dataTransfer.setData("Text",this.currentDragNode.id),r=a.currentDragNode.cloneNode(!0),i=a.currentDragNode.getDOMNode().getBoundingClientRect(),r.addClass("drag-image-clone"),r.setStyle("top",i.top),r.setStyle("left",i.left),this.dragContainer.appendChild(r),d.dataTransfer.setDragImage(r.getDOMNode(),r.get("offsetWidth")/2,r.get("offsetHeight")/2),setTimeout((function(){a.currentDragNode.addClass("placeholder"),a.dragContainer.removeChild(r)}),0),this.get("container").setStyle("width",this.get("container").getDOMNode().getBoundingClientRect().width),this.scrollContainer.setStyle("overflow","hidden")},handleDragOver:function(e){var t=e._event;t.preventDefault(),t.dataTransfer.dropEffect="move",this.throttledDragOver(e)},handleDrag:function(e){var t=this.scrollContainer.getDOMNode(),r=t.getBoundingClientRect(),i=this.mousePositionY-r.top;i<20?new this.YAnim.Anim({duration:.2,node:this.scrollContainer,to:{scroll:[0,t.scrollTop-150]}}).run():i>r.height-20&&new this.YAnim.Anim({duration:.2,node:this.scrollContainer,to:{scroll:[0,t.scrollTop+150]}}).run()},calculateDragOver:function(e){var t,r,i=e.target.ancestor(".drag-item",!0),a=0;if(i&&i.getAttribute("data-item-id")!==this.currentDragNode.getAttribute("data-item-id")){for(r=0;r<this.dragNodes.length;r++)if(this.dragNodes[r].getAttribute("data-item-id")===this.currentDragNode.getAttribute("data-item-id")){a=r,this.dragNodes.splice(r,1),t=this.reorderHelper.reorderedItemList.splice(r,1)[0];break}for(r=0;r<this.dragNodes.length;r++)if(this.dragNodes[r].getAttribute("data-item-id")===i.getAttribute("data-item-id")){this.currentDragNodeIndex=a>r?r:r+1,this.dragNodes.splice(this.currentDragNodeIndex,0,this.currentDragNode),this.reorderHelper.reorderedItemList.splice(this.currentDragNodeIndex,0,t);break}this.positionNodes(!0)}},handleDragEnd:function(t){var r=t.target.ancestor(".drag-item",!0);t.preventDefault(),r.removeClass("placeholder"),this.currentDragNodeInitialIndex!==this.currentDragNodeIndex&&(e.fire("reorderGrid:itemMoved"),-1===this.movedItems.indexOf(r.getAttribute("data-item-id"))&&this.movedItems.push(r.getAttribute("data-item-id"))),this.scrollContainer.setStyle("overflow","auto"),this.get("container").setStyle("width","initial")},handleDrop:function(e){e.preventDefault()},handleDoneClick:function(){this.queueReorder()},queueReorder:async function(){var t=this,r={};if(0!==this.movedItems.length)if(this.shouldReorder=!1,this.isReordering)this.shouldReorder=!0;else{this.isReordering=!0,this.dragNodes.forEach((function(e,i){for(var a=0;a<t.movedItems.length;a++)if(t.movedItems[a]===e.getAttribute("data-item-id")){r[e.getAttribute("data-item-id")]=i+1;break}})),e.fire("reorderGrid:saveStarted",{isSaving:!0});try{this.reorderHelper.hasPredefinedSortType()?await this.reorderHelper.sortItems(this.reorderHelper.sortType):(await this.reorderHelper.reorderItems(r),this.movedItems=[]),this.shouldReorder?this.queueReorder():e.fire("reorderGrid:saveFinished",{})}catch(t){e.fire("reorderGrid:saveFinished",{error:t})}finally{this.isReordering=!1}}},positionNodes:function(e){for(var t=this,r=t.dragContainer.getDOMNode().getBoundingClientRect().width,i=0,a=this.layout.maxWidth+1;a>this.layout.maxWidth;)a=r/++i-this.layout.itemSpacing.horizontal;if(a<=0&&(a=this.layout.maxWidth),this.perRow=i,this.cardWidth=a,e){var d=this.dragNodes.indexOf(this.currentDragNode),s=d<this.dragNodes.length?this.dragNodes[d+1]:null;this.dragContainer.removeChild(this.currentDragNode),s?t.dragContainer.insertBefore(this.currentDragNode,s):t.dragContainer.appendChild(this.currentDragNode)}else this.dragContainer.set("innerHTML","");this.dragNodes.forEach((function(r,i){r.setAttribute("draggable",!0),r.setStyle("width",a),r.setStyle("height",a),r.setStyle("marginBottom",t.layout.itemSpacing.vertical),r.setStyle("marginLeft",t.layout.itemSpacing.horizontal/2),r.setStyle("marginRight",t.layout.itemSpacing.horizontal/2),e||t.dragContainer.appendChild(r)})),t.dragContainer.getDOMNode().getBoundingClientRect().width!==r&&this.positionNodes(e),this.hideOutsideRows(),this.updateDeferredImages()},handleItemMouseEnter:function(e){var t=e.target.ancestor(".drag-drop-item",!0);clearTimeout(this.mouseLeaveTimeouts[t.getAttribute("data-item-id")]),t.one(".sub-photo-info-bar").addClass("shown"),setTimeout((function(){t.addClass("hovered")}),0)},handleItemMouseLeave:function(e){var t=e.target.ancestor(".drag-drop-item",!0);t.removeClass("hovered"),this.mouseLeaveTimeouts[t.getAttribute("data-item-id")]=setTimeout((function(){t.one(".sub-photo-info-bar").removeClass("shown")}),200)},handleScroll:function(e){this.hideOutsideRows(),this.checkLoadMore(e)},handlePageDragOver:function(e){this.mousePositionY=e.clientY},hideOutsideRows:function(){var e=this,t=this.scrollContainer.get("scrollTop"),r=e.cardWidth+e.layout.itemSpacing.vertical;this.dragNodes.forEach((function(i,a){var d=Math.floor(a/e.perRow),s=d===Math.floor((e.dragNodes.length-1)/e.perRow)&&e.dragNodes.length%e.perRow!=0;d*r<t-2*r||d*(e.cardWidth+e.layout.itemSpacing.vertical)>t+e.containerHeight+r?i.addClass("invisible"):i.removeClass("invisible"),s&&!e.reorderHelper.hasLoadedEnd&&e.reorderHelper.itemList.length>e.perRow?i.addClass("hidden"):i.removeClass("hidden")}))},updateDeferredImages:function(){this.dragNodes.forEach((function(e){let t=e.one(".photo");e.hasClass("invisible")||t.setStyle("backgroundImage",`url(${t.getAttribute("data-img-src-for-defer")})`)}))},checkLoadMore:function(e){var t=this.scrollContainer.get("scrollTop"),r=this.scrollContainer.get("scrollHeight");t+this.containerHeight+200>r&&this.loadMore()},reorderFullList:function(t){this.dragNodes=[],this.dragContainer.empty(),this.reorderHelper.reorderedItemList=t,this.movedItems=t.map((e=>e.id)),e.fire("reorderGrid:fullListReordered"),this.appendNewItems(t)}},{ATTRS:{}})}),"@VERSION@",{requires:["flickr-view","hermes-template-reorder-grid-view","photo-model-helper"],optionalRequires:["hermes-core"],langBundles:["common"]});YUI.add("reorder-grid-modal-view",(function(e,t){require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e,this.dragTipHtml=this.appContext.viewportData.getWidth()<700?this.intlMessage({intlName:"reorder.REORDER_TIP_TOUCH_SCREENS"}):this.intlMessage({intlName:"reorder.REORDER_TIP"}),this.dragErrorHtml=this.intlMessage({intlName:"reorder.REORDER_WENT_WRONG"})},subviewConfig:{"reorder-grid-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!1}},buildContainer:function(){this.confirmText=this.intlMessage({intlName:"common.DONE"}),this.savingText=this.intlMessage({intlName:"photo-editor.LOADING_EXPORTING"}),this.setContainerWithTemplate("reorder-grid-modal-view",{dragTipHtml:this.dragTipHtml,dragErrorHtml:this.dragErrorHtml,confirmText:this.confirmText,cancelText:this.intlMessage({intlName:"common.CANCEL"}),hasSortMenu:this.params.hasSortMenu})},activate:function(){var t=this.get("container");if(this.doneButton=t.one(".confirm-button"),this.cancelButton=t.one(".cancel-button"),this.dragTipNode=t.one(".drag-tip"),this.dragErrorNode=t.one(".drag-error"),this.dragTryAgainButton=t.one(".try-again-button"),this.reorderGrid=this.subviews["reorder-grid-view"],this.registerEventHandler(this.doneButton.on("click",this.handleDoneClick.bind(this))),this.registerEventHandler(this.cancelButton.on("click",this.handleCancelClick.bind(this))),this.registerEventHandler(this.dragTryAgainButton.on("click",this.handleDragTryAgainClick.bind(this))),this.registerEventHandler(e.on("reorderGrid:saveStarted",this.handleDragSaveStart.bind(this))),this.registerEventHandler(e.on("reorderGrid:saveFinished",this.handleDragSaveFinish.bind(this))),this.registerEventHandler(e.on("reorderGrid:itemMoved",(()=>{if(this.doneButton.removeAttribute("disabled"),this.params.hasSortMenu&&this.params.reorderHelper.hasPredefinedSortType()){this.params.reorderHelper.revertToManualSortType(),this.appContext.viewportData.getWidth()<=700?this.sortMenuTitle.set("text",`${this.intlMessage({intlName:"album-page.SORT"})}`):this.sortMenuTitle.set("text",`${this.intlMessage({intlName:"album-page.SORT_TYPE_LABEL"})} ${this.params.reorderHelper.getCurrentSortTypeName()}`)}}))),this.registerEventHandler(e.on("reorderGrid:fullListReordered",(()=>{this.doneButton.removeAttribute("disabled")}))),this.params.hasSortMenu){this.sortTooltipButton=t.one(".sort-tooltip-button"),this.sortMenuButton=t.one(".sort-dropdown-button"),this.sortMenuTitle=this.sortMenuButton.one(".menu-title"),this.sortMenuArrow=this.sortMenuButton.one(".arrow"),this.registerEventHandler(this.sortMenuButton.on("click",(()=>this.handleSortMenuClick()))),this.registerEventHandler(this.sortTooltipButton.on("click",(()=>this.handleSortTooltipClick()))),this.appContext.viewportData.getWidth()<=700?this.sortMenuTitle.set("text",`${this.intlMessage({intlName:"album-page.SORT"})}`):this.sortMenuTitle.set("text",`${this.intlMessage({intlName:"album-page.SORT_TYPE_LABEL"})} ${this.params.reorderHelper.getCurrentSortTypeName()}`)}},handleDragSaveStart:function(e){this.doneButton.set("innerHTML",this.savingText),this.doneButton.setAttribute("disabled")},handleDragSaveFinish:function(t){this.dragTipNode.toggleClass("hidden",!!t.error),this.dragErrorNode.toggleClass("hidden",!t.error),this.doneButton.set("innerHTML",this.confirmText),this.doneButton.removeAttribute("disabled"),t.error||e.fire("reorderGridModal:close",{action:"done"})},handleDragTryAgainClick:function(){this.reorderGrid.queueReorder()},handleDoneClick:function(){e.fire("reorderGridModal:doneClicked")},handleCancelClick:function(){e.fire("reorderGridModal:close",{action:"cancel"})},handleSortMenuClick:function(){this.dropdown=new e.Views.FluidDroparound({appContext:this.appContext,showDropArrow:!0,observePageResize:!0,anchorElement:this.sortMenuArrow,keyboardAnchorElement:this.sortMenuButton,closeOnScroll:!0,menuItems:this.params.reorderHelper.getSortMenuItems()}),this.dropdown.show(),this.registerEventHandler(this.dropdown.on("selected",(async t=>{if(t&&t.menuItem){let r=t.menuItem.value;if(r===this.params.reorderHelper.sortType)return void this.dropdown.close();if(this.params.reorderHelper.isManualSortType(this.params.reorderHelper.sortType)&&!this.params.reorderHelper.isManualSortType(r)&&!localStorage.getItem("dontShowAlbumSortWarningAgain"))try{await this.confirmChangeSort()}catch(e){return void this.dropdown.close()}this.sortMenuTitle.set("text",`${this.intlMessage({intlName:"album-page.SORT_TYPE_LABEL"})} ${t.menuItem.text}`),this.dropdown.close();let i=this.get("container").one(".loading-balls");i.toggleClass("hidden");try{const e=await this.params.reorderHelper.loadSortPreview(r);this.reorderGrid.reorderFullList(e),i.toggleClass("hidden")}catch(t){i.toggleClass("hidden"),new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"common.OOPS"}),htmlMessage:this.intlMessage({intlName:"products-flickrpro.SOMETHING_WENT_WRONG"}),showCancelButton:!1}),hasSubviewConfigRefactor:!0}).show()}}})))},confirmChangeSort:async function(){return new Promise(((t,r)=>{new e.Views.FluidModal({appContext:this.appContext,subview:new e.Views["confirmation-dialog-view"]({appContext:this.appContext,title:this.intlMessage({intlName:"album-page.CHANGE_SORT_ORDER_TITLE"}),htmlMessage:this.intlMessage({intlName:"album-page.CHANGE_SORT_ORDER_EXPLANATION"}),onConfirm:e=>{localStorage.setItem("dontShowAlbumSortWarningAgain",!0),t()},onCancel:e=>r(),onClose:e=>r()}),hasSubviewConfigRefactor:!0}).show()}))},handleSortTooltipClick:function(){new e.Views.FluidDroparound({appContext:this.appContext,anchorElement:this.sortTooltipButton,htmlMessage:e.StringHelper.preventOrphans(this.intlMessage({intlName:"album-page.SORT_ALBUM_TOOLTIP"})),closeOnScroll:!0,width:240}).show()}},{ATTRS:{}})}),"@VERSION@",{requires:["flickr-view","hermes-template-reorder-grid-modal-view","hermes-template-flickr-balls","reorder-grid-view","api-helper","string-helper"],optionalRequires:["hermes-core"],langBundles:["common","photo-editor","reorder","album-page","products-flickrpro"]});